---
title: 后端架构
date: 2021-08-07 09:16:08
tags: Java
---

公司新员工到了，要讲一节关于后端架构的课程。新员工是刚毕业的学生，那就用登录功能，介绍一下现在的架构情况。
### 前后端分离
在比较早期的设计开发中，前后端是不分离的，比如下图这个JSP+Servlet的设计：
![mvc.png](mvc.png)
在早期的实现中，服务器收到用户发起的请求后，开始处理数据，渲染html，最终将渲染好的html传递给浏览器，浏览器直接展示。这样做，需要开发人员前后端都有涉猎，要求比较高，催生了一些可能可以称之为全栈的开发人员。在开发过程中联调、debug都比较麻烦，而且服务器的压力比较高。
<!-- more -->
随着时间的推进，移动端也就是安卓和Ios系统和桌面端也逐渐兴起起来，对于服务端来说，这下不能为移动端或者桌面端渲染提供页面了。而且web端的页面也越来越炫酷，就催生出了前后端分离，那么后端就只提供数据接口，同时为多个用户终端服务，页面渲染交给前端自己来处理。
![多个用户终端对应后端](front-end-back-end.jpeg)

到这里现在的后端就独立出来了，我们现在知道后端就是为前端提供数据的，那后端到底是什么样子的呢，后端的架构又是什么样的，我们就借选课这个功能，介绍一下后端架构，我们以Java server为例介绍，Java目前的主流框架还是Spring全家桶为主。
### 登录
如果要选课，第一步肯定是要登录，要输入账号密码，数据在从前端传输到后端的过程中会不会有什么安全问题呢？（中间人攻击）+https
经过https安全传输后，我们的后端收到了账号密码，这时候我们要查库了吗？还不行，对于服务器来说，要记录很多的操作日志，比如什么人在什么时候登录，在什么时候操作了什么数据，那我们就会需要一个日志框架，用来记录刚刚提到的，比如用户登录操作、接口调用操作、数据操作，对于Java服务器来说，基于slf4j的logback，log4j框架是目前的主流，我们选用的是logback。
![日志框架出现]()

然后和数据库里的数据比对，发现你的账号密码都是正确的，那就可以继续选课了，那么这里我们的数据库就要出现了，数据库里存储了用户信息（包括账号密码，密码肯定不是明文，一定是密文的，而且不能被解密）。
![数据库出现]()

那后端是怎么连接数据库的呢？我们一般为了保证数据安全性和稳定性，数据库不会和服务部署在一起。对于Java来说，大家可能听说过JDBC，通过JDBC打开数据库连接，对数据库进行操作，关闭链接，就获取到我们要的数据。但如果操作一次，就打开一次TCP连接，是非常消耗资源的，因此我们就引入了连接池，c3p0（星球大战中机器人），druid，hikaricp等等，打开多个连接，等待使用。
![连接池出现]()

从开发角度说，对数据库的crud增删改查全部手动拼接字符串的话非常累，需要一个对数据库操作更加简便，减轻开发工作量的东西，就出现了现在比较流行的两大持久层框架 —— jpa 和 mybatis。在国外更多的是jpa，在国内mybatis为主。jpa脱身于hibernate，更多的思想是面向对象，将数据库内的数据也作为对象来处理；mybatis更注重于sql的管理，是一个半orm框架。因为国内软件行业需求迭代非常快，mybatis更加灵活。
![mybatis出现]()

这样，持久层简单框架大概就先介绍这些。

### 选课
接下来你能选课吗？

还不行，服务器得知道两件事：第一，你是谁？第二，你能选课吗？
1. 你是谁 - 用户认证
在上面登录那一块，我们已经做了用户的登录账号密码认证，接下来怎么知道调用接口的也是登录的这个人呢？  
以前我们使用的是session，在以前的设计中，session是一个可以判断用户信息的东西。但是现在我们进入了前后端分离阶段，移动端可能并没有session，因此我们引入了JWT，我们在用户登录之后分发一个可以代表用户的唯一token给用户，访问请求时必须带这个这JWT，并且通过验证才能继续访问。
![JWT出现]()
2. 能不能选课 - 用户授权
现在我们可以接触到这个接口了，但是有没有权限访问呢？比如你是一个已经毕业的学生，那你肯定不能选课了 —— 基于角色的权限控制系统（role-based access control）。

这就是访问数据接口前的安全验证了，也就是安全框架要做的事情。安全框架做的两件事情：用户认证和用户授权，我们主流的安全框架是Spring-security，shiro。
![安全框架出现]()

终于，现在我们能访问到数据了。当然，我们也不可能只加载一个选课的数据，总是要配合前端，把一个完整的有内容的前端页面展示出来。这时候就有一个问题，有些数据（比如说组织架构）是很少变动的，每次都要去数据库里查，查询出来的东西都是一样的。虽然我们已经有了连接池，解决了一部分查询效率的问题，但查这些固定数据还是有些浪费资源。这时候我们就引入了缓存框架，把这些读多写少的数据存储在缓存中，每次读取直接从缓存中获取，减少计算量，提高响应速度。缓存框架主流的memcache，redis（redis同时作为主流非关系型数据库）。
![缓存框架出现]()

### 一起选课
现在你能选课了，那你能抢到你想要的课程吗？

